<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<title>blog式日历控件</title>
</head>
<body>
<style type="text/css">
*{
	margin: 0;
	padding: 0;
}
body{
	background:url(data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAA8AAD/4QNvaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjMtYzAxMSA2Ni4xNDU2NjEsIDIwMTIvMDIvMDYtMTQ6NTY6MjcgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6MDE4MDExNzQwNzIwNjgxMThGNjJBQjFBMTZFRDMxQUEiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6ODg0NTMxNThGRkFEMTFFMUJFODBCNDA3MzA5MkNCMTUiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6ODg0NTMxNTdGRkFEMTFFMUJFODBCNDA3MzA5MkNCMTUiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDowODgwMTE3NDA3MjA2ODExQUE5NkI0MTkyQzIwQTY2OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDowMTgwMTE3NDA3MjA2ODExOEY2MkFCMUExNkVEMzFBQSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pv/uAA5BZG9iZQBkwAAAAAH/2wCEAAYEBAQFBAYFBQYJBgUGCQsIBgYICwwKCgsKCgwQDAwMDAwMEAwODxAPDgwTExQUExMcGxsbHB8fHx8fHx8fHx8BBwcHDQwNGBAQGBoVERUaHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fH//AABEIACgAKAMBEQACEQEDEQH/xABrAAEBAQEBAQAAAAAAAAAAAAAAAgEDBAcBAQEBAAAAAAAAAAAAAAAAAAABAhABAAEDAgMFBwUAAAAAAAAAAQIAESFBAzFRYXGB0RJSkaGxwfEiMkJyohMzEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwD6fCEprEQsXV83qAtYXWsorc2N3bzKKj+q0gz+4KIhbnVoFruaBfrdoOmxuG3ujLAsReQTjK/8aK6S/rhtR80MoH2kB/ziuWK5ZUHnUuoIaHSiD9KB79CgzhbPHWgplK3l0G4HW3hQSvjQDPLHOQfFoNlBilyy5LI620oF+7toMKDQL2WxqhfwoO0ZnkSClhD8i32yfU+mio3ZEpLoLZ7ZMvnREHDlegN3GvsoHBoF0EeC57vrQM5x1tQf/9k=);
	font:12px 'Courgette', cursive; 
	color: #000; 
	line-height: 32px; 
	font-weight: bold;
	padding: 50px;
}
ul{ 
	list-style: none;
}
h2{ 
	font-size: 14px;
}
a{ 
	color:#fff; 
	text-decoration: none; 
	letter-spacing: -3px;
}

</style>
<script type="text/javascript">
var $ = function (id) {
    return "string" == typeof id ? document.getElementById(id) : id;
};

var Class = {
  create: function() {
    return function() {
      this.initialize.apply(this, arguments);
    }
  }
}

var Extend = function(destination, source) {
    for (var property in source) {
        destination[property] = source[property];
    }
    return destination;
}


var Calendar = Class.create();
Calendar.prototype = {
  initialize: function(container, options) {
	this.Container = $(container);//容器(table结构)
	this.Days = [];//日期对象列表
	
	this.SetOptions(options);
	
	this.Year = this.options.Year || new Date().getFullYear();
	this.Month = this.options.Month || new Date().getMonth() + 1;
	this.SelectDay = this.options.SelectDay ? new Date(this.options.SelectDay) : null;
	this.onSelectDay = this.options.onSelectDay;
	this.onToday = this.options.onToday;
	this.onFinish = this.options.onFinish;	
	
	this.Draw();
  },
  //设置默认属性
  SetOptions: function(options) {
	this.options = {//默认值
		Year:			0,//显示年
		Month:			0,//显示月
		SelectDay:		null,//选择日期
		onSelectDay:	function(){},//在选择日期触发
		onToday:		function(){},//在当天日期触发
		onFinish:		function(){}//日历画完后触发
	};
	Extend(this.options, options || {});
  },
  //当前月
  NowMonth: function() {
	this.PreDraw(new Date());
  },
  //上一月
  PreMonth: function() {
	this.PreDraw(new Date(this.Year, this.Month - 2, 1));
  },
  //下一月
  NextMonth: function() {
	this.PreDraw(new Date(this.Year, this.Month, 1));
  },
  //上一年
  PreYear: function() {
	this.PreDraw(new Date(this.Year - 1, this.Month - 1, 1));
  },
  //下一年
  NextYear: function() {
	this.PreDraw(new Date(this.Year + 1, this.Month - 1, 1));
  },
  //根据日期画日历
  PreDraw: function(date) {
	//再设置属性
	this.Year = date.getFullYear(); this.Month = date.getMonth() + 1;
	//重新画日历
	this.Draw();
  },
  //画日历
  Draw: function() {
	//用来保存日期列表
	var arr = [];
	//用当月第一天在一周中的日期值作为当月离第一天的天数
	for(var i = 1, firstDay = new Date(this.Year, this.Month - 1, 1).getDay(); i <= firstDay; i++){ arr.push(0); }
	//用当月最后一天在一个月中的日期值作为当月的天数
	for(var i = 1, monthDay = new Date(this.Year, this.Month, 0).getDate(); i <= monthDay; i++){ arr.push(i);}
	var dayLn =arr.length;
	var fix = 7-dayLn%7;
	for(var i = 1;i<=fix;i++){arr.push(i)}
	//清空原来的日期对象列表
	this.Days = [];
	//插入日期
	var frag = document.createDocumentFragment();
	while(arr.length){
		//每个星期插入一个tr
		var row = document.createElement("tr");
		//每个星期有7天
		for(var i = 1; i <= 7; i++){
			
			var cell = document.createElement("td"); cell.innerHTML = "&nbsp;";
			if(arr.length){
				console.log(dayLn)
				var d = arr.shift();
				if(d){
					cell.innerHTML = d;
					this.Days[d] = cell;
					if(arr.length-fix<0){cell.className='grey'}
					var on = new Date(this.Year, this.Month - 1, d);
					//判断是否今日
					this.IsSame(on, new Date()) && this.onToday(cell);
					//判断是否选择日期
					this.SelectDay && this.IsSame(on, this.SelectDay) && this.onSelectDay(cell);
				}else if(d==0){
				//补齐之前的日期
				cell.innerHTML = new Date(this.Year, this.Month - 1, -firstDay+i).getDate();
				cell.className='grey'
				}
			}
			row.appendChild(cell);
		}
		frag.appendChild(row);
	}
	//先清空内容再插入(ie的table不能用innerHTML)
	while(this.Container.hasChildNodes()){ this.Container.removeChild(this.Container.firstChild); }
	this.Container.appendChild(frag);
	//附加程序
	this.onFinish();
  },
  //判断是否同一日
  IsSame: function(d1, d2) {
	return (d1.getFullYear() == d2.getFullYear() && d1.getMonth() == d2.getMonth() && d1.getDate() == d2.getDate());
  } 
}
</script>
<style type="text/css">

.Calendar {
	width: 211px;  
	padding: 4px; 
	box-shadow: 0 1px 1px #ebedea; 
	margin:50px auto; 
	background: #a2a4a1; 
	border-radius: 5px;

}
.Calendar a{
	color:#1e5494;
}
.Calendar > h2{ 
	margin:0 -1px 0 0; 
	border:1px solid #41531d; 
	box-shadow:inset 0 1px 1px #a5ce55; 
	border-radius: 3px 3px 0 0;
	padding:0 8px; 
	text-align: center; 
	color: #fff; 
	text-shadow:0 -1px 0px #999; 
	height: 32px;	
	background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(146,183,74,1)), color-stop(100%,rgba(100,134,34,1)));
	background-image: -webkit-linear-gradient(top, rgba(146,183,74,1) 0%, rgba(100,134,34,1) 100%);
	background-image: -moz-linear-gradient(top, rgba(146,183,74,1) 0%, rgba(100,134,34,1) 100%);
	background-image: -o-linear-gradient(top, rgba(146,183,74,1) 0%, rgba(100,134,34,1) 100%);
	background-image: -ms-linear-gradient(top, rgba(146,183,74,1) 0%, rgba(100,134,34,1) 100%);
	background-image: linear-gradient(top, rgba(146,183,74,1) 0%, rgba(100,134,34,1) 100%);
}


.Calendar table{
	border-radius: 0 0 5px 5px; 
	border:1px solid #818380; 
	font-size: 0; 
	background: #fff; 
	box-shadow:0 1px 1px #d9d9d9,0 2px 1px #555; 
	margin-right: -1px; 
	zoom: 1;

}

.Calendar table thead{color:#acacac;}

.Calendar table td {
	width:29px;
	border-right: 1px solid #ccc; 
	border-top: 1px solid #ccc; 
	text-align: center; 
	font-size: 12px;
	cursor:pointer;
}
#idCalendarPre{
	cursor:pointer;
	float:left;
	padding-right:5px;
}
#idCalendarNext{
	cursor:pointer;
	float:right;
	padding-right:5px;
}
#idCalendar td.onToday {
	font-weight:bold;
	color:#C60;
}
#idCalendar td.onSelect {
	font-weight:bold;
}
.tip{ 
	position: relative;
	color:orange;
}
.tip:after{ 
	display: block; 
	content: ""; 
	position: absolute; 
	border:4px solid orange; 
	border-color:orange orange transparent transparent ; 
	top: 0; 
	right: 0; 
}
.tooltipBox{ 
	position: absolute; 
	top:32px; 
	left:-15px; 
	z-index: 99; 
	display: none;
	width: 215px; 
	background: #eaeff5; 
	border:1px solid #64777e;  
	border-radius:5px; 
	box-shadow:0 1px 0 #cdd5d8,0 2px 0 #64777e,0 3px 0 #cdd5d8,0 4px 0 #64777e;
}
.tip:hover > .tooltipBox{ 
	display: block;
}
.tooltipBox:after,
.tooltipBox:before{ 
	position: absolute; 
	display: block; 
	content: ""; 
	border-style: solid;
}
.tooltipBox:after{ 
	border-width: 10px; 
	border-color: transparent  transparent #64777e; 
	top: -20px; 
	left: 20px;
	z-index: 2;
}
.tooltipBox:before{ 
	border-width: 8px; 
	border-color:transparent  transparent #717f8a; 
	top:-16px; 
	left: 22px; 
	z-index: 3;
}
.tooltipBox > h2{ 
	background: #717f8a; 
	line-height: 40px; 
	color: #fff; 
	border-radius:  4px 4px 0 0; 
	text-indent: 1em;
}
.tooltip li{ 
	min-height: 36px; 
	padding: 5px; 
	border-bottom: 1px solid #a8adb1; 
	box-shadow: 0 1px 1px #fff; 
	color: #232323;
}
.tooltip li:last-child{ 
	border-bottom: none; 
	box-shadow: none;
}
.timg{ 
	width:36px; 
	height: 36px; 
	float: left; 
	margin-right: 10px;
	background: #232323; 
	border-radius: 5px; 
	overflow: hidden;
}
.timg img{ 
	width: 36px; 
	height: 36px;
}
.ttext {
	overflow: hidden;
	zoom:1;
}
.grey{color:grey}

</style>
<div class="Calendar">
<h2>  <div id="idCalendarPre">&lt;&lt;</div>
  <div id="idCalendarNext">&gt;&gt;</div>
  <span id="idCalendarYear"></span>年 <span id="idCalendarMonth"></span>月
  </h2>
<table cellspacing="0">
    <thead>
      <tr>
        <td>日</td>
        <td>一</td>
        <td>二</td>
        <td>三</td>
        <td>四</td>
        <td>五</td>
        <td>六</td>
      </tr>
    </thead>
    <tbody id="idCalendar">
    </tbody>
  </table>
</div>

<input id="idCalendarPreYear" type="button" value="上一年" />
<input id="idCalendarNow" type="button" value="当前月" />
<input id="idCalendarNextYear" type="button" value="下一年" />

<script language="JavaScript">

var cale = new Calendar("idCalendar", {
	SelectDay: new Date().setDate(10),
	onSelectDay: function(o){ o.className = "onSelect"; },
	onToday: function(o){ o.className = "onToday"; },
	onFinish: function(){
		$("idCalendarYear").innerHTML = this.Year; $("idCalendarMonth").innerHTML = this.Month;
		var flag = [10,15,20];
		for(var i = 0, len = flag.length; i < len; i++){
			this.Days[flag[i]].innerHTML = "<a href='javascript:void(0);' onclick=\"alert('日期是:"+this.Year+"/"+this.Month+"/"+flag[i]+"');return false;\">" + flag[i] + "</a>"+'<div class="tooltipBox"> <h2>Your Journey(2 items)</h2> <ul class="tooltip"> <li> <div class="timg"> <img src="http://www.w3cplus.com/sites/all/themes/marvin/logo.png" alt="大漠 前端攻城师"> </div> <div class="ttext"> http://www.w3cplus.com </div> </li> <li> <div class="timg"> <img src="http://www.w3cplus.com/sites/all/themes/marvin/logo.png" alt="大漠 前端攻城师"> </div> <div class="ttext"> http://www.w3cplus.com </div> </li> </ul> </div>';
			this.Days[flag[i]].className='tip'
		}
	}
});

$("idCalendarPre").onclick = function(){ cale.PreMonth(); }
$("idCalendarNext").onclick = function(){ cale.NextMonth(); }

$("idCalendarPreYear").onclick = function(){ cale.PreYear(); }
$("idCalendarNextYear").onclick = function(){ cale.NextYear(); }

$("idCalendarNow").onclick = function(){ cale.NowMonth(); }

</script>
</body>
</html>
